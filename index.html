<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Secure v2 Browser Demo</title>
    <link href="dist/styles.css" rel="stylesheet">
</head>
<body class="h-screen overflow-hidden">
    <!-- Main Container - Flexible height -->
    <div class="w-[1920px] h-screen mx-auto grid grid-cols-asymmetric bg-gray-50">
        <!-- Column 1: Card Selection & Authentication Flow (320px) -->
        <div class="flex flex-col h-full overflow-hidden border-r border-gray-300 bg-white">
            <!-- Header -->
            <div class="px-4 py-3 border-b border-gray-200 bg-gradient-to-r from-3ds-primary to-blue-600">
                <h1 class="text-xl font-bold text-white">3DS v2 Demo</h1>
                <p class="text-sm text-blue-100">1920×1080 Optimized</p>
            </div>
            
            <!-- Card Selection -->
            <div class="px-4 py-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-800 mb-3">Test Card Selection</h2>
                <div class="form-group">
                    <label for="cardNumber" class="form-label text-sm">Select Test Card</label>
                    <select id="cardNumber" onchange="updateTestInfo()" class="form-select text-sm">
                    <optgroup label="Enrollment Tests">
                        <option value="9000100111111111">9000100111111111 - Card not enrolled</option>
                    </optgroup>
                    <optgroup label="Frictionless Success (Y) - All Versions">
                        <option value="4000100111110003">4000100111110003 - With 3DS Method</option>
                        <option value="4000100211111103">4000100211111103 - Without 3DS Method</option>
                        <option value="4000100311112203">4000100311112203 - 3DS Method timeout</option>
                    </optgroup>
                    <optgroup label="Frictionless Success (Y) - Version Specific">
                        <option value="4000100411111003">4000100411111003 - v2.1 only, with 3DS Method</option>
                        <option value="4000100511112003">4000100511112003 - v2.2 only, with 3DS Method ✓</option>
                        <option value="4000100611113003">4000100611113003 - v2.3 only, with 3DS Method</option>
                        <option value="6000100611111103">6000100611111103 - v2.1 only, no 3DS Method ✓</option>
                    </optgroup>
                    <optgroup label="Frictionless Failure (N)">
                        <option value="4000100711110013">4000100711110013 - All versions, with 3DS Method</option>
                        <option value="4000100811111113">4000100811111113 - v2.1 only, without 3DS Method</option>
                        <option value="4000100911112213">4000100911112213 - v2.2 only, 3DS Method timeout</option>
                    </optgroup>
                    <optgroup label="Frictionless Other Outcomes">
                        <option value="4000101011110023">4000101011110023 - Attempted (A)</option>
                        <option value="4000101111110033">4000101111110033 - Rejected (R)</option>
                        <option value="4000101211112043">4000101211112043 - Information only (I) v2.2+</option>
                        <option value="4000101311110053">4000101311110053 - Unable to authenticate (U)</option>
                        <option value="4000101411110063">4000101411110063 - DS timeout</option>
                    </optgroup>
                    <optgroup label="Challenge - Auto Pass (Y)">
                        <option value="4000101511110070">4000101511110070 - All versions, with 3DS Method</option>
                        <option value="4000101611111170">4000101611111170 - v2.1 only, without 3DS Method</option>
                        <option value="7000100911112070">7000100911112070 - v2.2 only, with 3DS Method ✓</option>
                    </optgroup>
                    <optgroup label="Challenge - Auto Fail (N)">
                        <option value="4000101711110071">4000101711110071 - All versions, with 3DS Method</option>
                        <option value="3000101011111071">3000101011111071 - v2.1 only, with 3DS Method ✓</option>
                        <option value="4000101811112271">4000101811112271 - v2.2 only, 3DS Method timeout</option>
                    </optgroup>
                    <optgroup label="Challenge - Manual Interaction">
                        <option value="4000101911110072">4000101911110072 - All versions, with 3DS Method</option>
                        <option value="3000100811111072" selected>3000100811111072 - v2.1 only, with 3DS Method ✓</option>
                        <option value="4000102011112072">4000102011112072 - v2.2 only, with 3DS Method</option>
                    </optgroup>
                    <optgroup label="Special Documented Examples">
                        <option value="5000100411110203">5000100411110203 - 3DS Method timeout v2.1-2.2 ✓</option>
                    </optgroup>
                    <optgroup label="Custom Test Configuration">
                        <option value="custom">Enter custom PAN...</option>
                    </optgroup>
                    </select>
                    <input type="text" id="customCardNumber" class="form-input text-sm mt-2 hidden" placeholder="Enter 16-digit test card number">
                </div>
                <div id="testInfo" class="test-info text-xs"></div>
                <button id="startAuthBtn" onclick="startAuthentication()" class="btn btn-primary w-full mt-4 text-sm">
                    <span id="btnText">Start 3DS Authentication</span>
                    <span id="btnSpinner" class="spinner ml-2 hidden"></span>
                </button>
            </div>
            
            <!-- Authentication Flow Steps -->
            <div class="flex-1 px-4 py-4 overflow-y-auto custom-scrollbar">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">Authentication Flow</h3>
                <div class="space-y-2" id="steps">
                    <div class="step" id="step-preauth">
                        <span class="step-icon">1️⃣</span>
                        <span class="text-sm">Pre-Authentication Check</span>
                    </div>
                    <div class="step" id="step-3dsmethod">
                        <span class="step-icon">2️⃣</span>
                        <span class="text-sm">3DS Method (if available)</span>
                    </div>
                    <div class="step" id="step-auth">
                        <span class="step-icon">3️⃣</span>
                        <span class="text-sm">Authentication Request</span>
                    </div>
                    <div class="step" id="step-challenge">
                        <span class="step-icon">4️⃣</span>
                        <span class="text-sm">Challenge Flow</span>
                    </div>
                    <div class="step" id="step-postauth">
                        <span class="step-icon">5️⃣</span>
                        <span class="text-sm">Get Final Result</span>
                    </div>
                </div>
                
                <!-- Help Section -->
                <div class="mt-6 space-y-2">
                    <details class="bg-gray-50 rounded-lg p-3 text-xs">
                        <summary class="cursor-pointer font-semibold text-gray-700">Test Card Patterns</summary>
                        <div class="mt-2 space-y-1 text-gray-600">
                            <p>Last 4 digits determine behavior:</p>
                            <ul class="list-disc list-inside ml-2">
                                <li><strong>1st:</strong> Version (0=all, 1=v2.1, 2=v2.2, 3=v2.3)</li>
                                <li><strong>2nd:</strong> 3DS Method (0=yes, 1=no, 2=timeout)</li>
                                <li><strong>3rd:</strong> Outcome (0-6=frictionless, 7=challenge)</li>
                                <li><strong>4th:</strong> Challenge type (0=auto-pass, 1=auto-fail, 2=manual)</li>
                            </ul>
                        </div>
                    </details>
                </div>
            </div>
        </div>
        
        <!-- Column 2: API Responses & Status (960px) -->
        <div class="flex flex-col h-full overflow-hidden bg-white border-r border-gray-300">
            <!-- Header -->
            <div class="px-6 py-3 border-b border-gray-200 bg-gray-50 flex items-center" style="height: 73px;">
                <h2 class="text-xl font-semibold text-gray-800">API Responses & Status</h2>
            </div>
            
            <!-- Current Status -->
            <div class="px-6 py-3 border-b border-gray-200">
                <h3 class="text-sm font-semibold text-gray-700 mb-2">Current Status</h3>
                <div id="statusMessage" class="api-response max-h-24 overflow-y-auto custom-scrollbar">
                    Ready to start authentication...
                </div>
            </div>
            
            <!-- API Responses -->
            <div class="flex-1 px-6 py-3 overflow-hidden flex flex-col min-h-0">
                <h3 class="text-sm font-semibold text-gray-700 mb-2 flex-shrink-0">API Transaction Log</h3>
                <div id="apiResponses" class="api-response flex-1 overflow-y-auto custom-scrollbar min-h-0">
                    <em>API responses will appear here...</em>
                </div>
            </div>
        </div>
        
        <!-- Column 3: Challenge Frame (640px) -->
        <div class="flex flex-col h-full overflow-hidden bg-white">
            <!-- Header -->
            <div class="px-6 py-3 border-b border-gray-200 bg-gray-50" style="height: 73px;">
                <div>
                    <h2 class="text-xl font-semibold text-gray-800">Challenge Frame</h2>
                    <p class="text-sm text-gray-600">User interaction area for 3DS challenges</p>
                </div>
            </div>
            
            <!-- Challenge Frame Container -->
            <div class="flex-1 px-6 py-3 bg-white overflow-hidden">
                <div class="h-full rounded-lg overflow-hidden shadow-inner bg-gray-50 relative">
                    <iframe id="challengeIframe" name="challengeIframe" class="hidden absolute inset-0 w-full h-full"></iframe>
                    <div id="challengePlaceholder" class="h-full flex items-center justify-center text-gray-400">
                        <div class="text-center">
                            <svg class="w-24 h-24 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                            </svg>
                            <p class="text-lg font-medium">Challenge frame will appear here</p>
                            <p class="text-sm mt-2">Complete the authentication flow to see challenges</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Hidden iframe for 3DS Method -->
    <iframe id="threeDSMethodIframe" name="threeDSMethodIframe" class="hidden"></iframe>
    
    <!-- Hidden form for 3DS Method submission -->
    <form id="threeDSMethodForm" class="hidden">
        <input type="hidden" name="threeDSMethodData" id="threeDSMethodData">
    </form>
    
    <!-- Hidden form for Challenge submission -->
    <form id="challengeForm" class="hidden">
        <input type="hidden" name="creq" id="creqData">
    </form>
    
    <!-- External JavaScript -->
    <script src="app.js"></script>
    
    <!-- Custom script for Tailwind classes updates -->
    <script>
        // Custom UI handling for Tailwind classes
        const originalUpdateStatus = window.updateStatus;
        window.updateStatus = function(message, isError = false) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            if (isError) {
                statusDiv.classList.remove('bg-gray-100', 'text-gray-900');
                statusDiv.classList.add('bg-red-50', 'text-red-900');
            } else {
                statusDiv.classList.remove('bg-red-50', 'text-red-900');
                statusDiv.classList.add('bg-gray-100', 'text-gray-900');
            }
        };
        
        // Handle custom card input visibility
        document.getElementById('cardNumber').addEventListener('change', function() {
            const customInput = document.getElementById('customCardNumber');
            if (this.value === 'custom') {
                customInput.classList.remove('hidden');
            } else {
                customInput.classList.add('hidden');
            }
        });
        
        // Handle challenge iframe visibility
        const originalPerformChallenge = window.performChallenge;
        window.performChallenge = async function() {
            // Hide placeholder, show iframe
            document.getElementById('challengePlaceholder').classList.add('hidden');
            document.getElementById('challengeIframe').classList.remove('hidden');
            
            // Call original function
            return originalPerformChallenge.apply(this, arguments);
        };
        
        // Handle button spinner
        const originalStartAuth = window.startAuthentication;
        window.startAuthentication = async function() {
            const btnText = document.getElementById('btnText');
            const btnSpinner = document.getElementById('btnSpinner');
            
            // Show spinner
            btnText.textContent = 'Processing...';
            btnSpinner.classList.remove('hidden');
            
            try {
                await originalStartAuth.apply(this, arguments);
            } finally {
                // Hide spinner
                btnText.textContent = 'Start 3DS Authentication';
                btnSpinner.classList.add('hidden');
            }
        };
    </script>
</body>
</html>